import Foundation

/* JSON data:

url: https://api.coingecko.com/api/v3/global

{
    "data": {
        "active_cryptocurrencies": 16776,
        "upcoming_icos": 0,
        "ongoing_icos": 49,
        "ended_icos": 3376,
        "markets": 1203,
        "total_market_cap": {
            "btc": 36140331.17269411,
            "eth": 1146288558.9214923,
            "ltc": 30202572791.74989,
            "bch": 8111632201.606059,
            "bnb": 5335391098.988599,
            "eos": 4107999755009.926,
            "xrp": 1167498248829.542,
            "xlm": 7827670805198.498,
            "link": 157646479211.0698,
            "dot": 540265101943.89465,
            "yfi": 464091585.1917793,
            "usd": 3761619340618.5156,
            "aed": 13816465454285.217,
            "ars": 3.916651133900893e+15,
            "aud": 6078893464639.08,
            "bdt": 457074445072561.9,
            "bhd": 1417724236524.3936,
            "bmd": 3761619340618.5156,
            "brl": 22972645661000.793,
            "cad": 5450774505523.26,
            "chf": 3440685501715.6255,
            "clp": 3.802056748530162e+15,
            "cny": 27553861670030.633,
            "czk": 92499724233545.53,
            "dkk": 27326659861857.273,
            "eur": 3657926541875.026,
            "gbp": 3088865006406.916,
            "gel": 10682998927356.586,
            "hkd": 29285711214451.4,
            "huf": 1512547136862705.5,
            "idr": 6.162698581928721e+16,
            "ils": 13414698177371.773,
            "inr": 325698870202619.06,
            "jpy": 587881162286805.0,
            "krw": 5.4837481760484e+15,
            "kwd": 1160670217263.8867,
            "lkr": 1115414013227273.6,
            "mmk": 7.891877376617645e+15,
            "mxn": 78211213168206.11,
            "myr": 16949856748827.031,
            "ngn": 5.863123217641861e+15,
            "nok": 43062642049466.695,
            "nzd": 6737030146093.037,
            "php": 220254074681519.94,
            "pkr": 1048642659367472.6,
            "pln": 15608230071563.354,
            "rub": 385549517805543.75,
            "sar": 14114111107850.338,
            "sek": 42109259627586.945,
            "sgd": 5144766772163.944,
            "thb": 129376048493243.8,
            "try": 133286210420004.02,
            "twd": 123732825780635.17,
            "uah": 158423901231929.9,
            "vef": 376650944576.13165,
            "vnd": 9.546612798068886e+16,
            "zar": 70501022005740.33,
            "xdr": 2900182180281.492,
            "xag": 123984252417.3621,
            "xau": 1392062469.3826945,
            "bits": 36140331172694.11,
            "sats": 3.614033117269411e+15
        },
        "total_volume": {
            "btc": 2149460.7527688183,
            "eth": 68175973.73350249,
            "ltc": 1796310181.5060177,
            "bch": 482442592.31972593,
            "bnb": 317324534.55249226,
            "eos": 244324940011.8742,
            "xrp": 69437428583.42911,
            "xlm": 465553873897.0059,
            "link": 9376087846.488867,
            "dot": 32132484541.16138,
            "yfi": 27602033.95185527,
            "usd": 223723825354.00226,
            "aed": 821739847763.504,
            "ars": 232944403701762.78,
            "aud": 361544637210.65356,
            "bdt": 27184686716965.14,
            "bhd": 84319719985.32062,
            "bmd": 223723825354.00226,
            "brl": 1366307353400.633,
            "cad": 324187009129.2169,
            "chf": 204636156022.44952,
            "clp": 226128856476557.6,
            "cny": 1638777020718.067,
            "czk": 5501458354985.056,
            "dkk": 1625264101666.685,
            "eur": 217556654384.29385,
            "gbp": 183711490360.91504,
            "gel": 635375664005.3666,
            "hkd": 1741779469911.0496,
            "huf": 89959350174844.33,
            "idr": 3.665289803157155e+15,
            "ils": 797844577148.919,
            "inr": 19371071487319.95,
            "jpy": 34964468908418.293,
            "krw": 326148131464533.9,
            "kwd": 69031328655.92952,
            "lkr": 66339697692971.02,
            "mmk": 469372585592696.7,
            "mxn": 4651643404377.879,
            "myr": 1008099557045.1342,
            "ngn": 348711614864522.6,
            "nok": 2561167980270.082,
            "nzd": 400687581418.4152,
            "php": 13099699803609.943,
            "pkr": 62368444528602.695,
            "pln": 928305770046.7252,
            "rub": 22930712859601.645,
            "sar": 839442442892.2902,
            "sek": 2504465176734.111,
            "sgd": 305987075936.6689,
            "thb": 7694692593040.027,
            "try": 7927251048533.435,
            "twd": 7359059649281.875,
            "uah": 9422325334302.469,
            "vef": 22401466632.696228,
            "vnd": 5.677886412627441e+15,
            "zar": 4193076679549.7803,
            "xdr": 172489503281.1583,
            "xag": 7374013349.768536,
            "xau": 82793476.04875563,
            "bits": 2149460752768.8184,
            "sats": 214946075276881.84
        },
        "market_cap_percentage": {
            "btc": 54.81948382080392,
            "eth": 10.512172717886665,
            "xrp": 4.931727110295529,
            "usdt": 3.6738890763987166,
            "sol": 3.290186005631912,
            "bnb": 2.7344782729856907,
            "doge": 1.5414093601364967,
            "usdc": 1.2615970113228072,
            "ada": 1.0255538234058705,
            "steth": 0.8355947552508322
        },
        "market_cap_change_percentage_24h_usd": -2.8931336179567615,
        "updated_at": 1737240709
    }
}

*/

struct GlobalData: Codable {
  let data: MarketDataModel
}

struct MarketDataModel: Codable {
  let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
  let marketCapChangePercentage24HUsd: Double

  enum CodingKeys: String, CodingKey {
    case totalMarketCap = "total_market_cap"
    case totalVolume = "total_volume"
    case marketCapPercentage = "market_cap_percentage"
    case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
  }

  var marketCap: String {
    if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
      return "$" + item.value.formattedWithAbbreviations()
    }

    return ""
  }

  var volume: String {
    if let item = totalVolume.first(where: { $0.key == "usd" }) {
      return "$" + item.value.formattedWithAbbreviations()
    }

    return ""
  }

  var btcDominance: String {
    if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
      return item.value.asPercentString()
    }

    return ""
  }
}
